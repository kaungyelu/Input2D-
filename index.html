<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KK-User</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            padding: 20px;
            background-color: #f5f5f5;
            max-width: 500px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }
        
        #addTimeBtn {
            width: 100%;
            padding: 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        #addTimeBtn:hover {
            background-color: #45a049;
        }
        
        #inputBox {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
        }
        
        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        #dateInput {
            background-color: #f9f9f9;
        }
        
        #timeInput {
            text-transform: uppercase;
        }
        
        #saveBtn {
            width: 100%;
            padding: 12px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        
        #saveBtn:hover {
            background-color: #0b7dda;
        }
        
        #listView {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .list-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: background-color 0.2s;
            text-decoration: none;
            color: inherit;
            display: block;
        }
        
        .list-item:hover {
            background-color: #f9f9f9;
        }
        
        .item-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .item-date {
            font-weight: bold;
            color: #333;
            flex: 1;
        }
        
        .item-time {
            color: #666;
            margin: 0 15px;
        }
        
        .item-delete {
            color: #ff4444;
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 5px 10px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }
        
        .item-delete:hover {
            background-color: rgba(255, 68, 68, 0.1);
        }
        
        #deleteBtn {
            width: 100%;
            padding: 15px;
            background-color: #ff4444;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            display: none;
        }
        
        #deleteBtn:hover {
            background-color: #cc0000;
        }
        
        .empty-message {
            text-align: center;
            padding: 20px;
            color: #888;
        }
        
        .error-message {
            color: #ff4444;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <h1>Time Manager</h1>
    
    <button id="addTimeBtn">Add Time</button>
    
    <div id="inputBox">
        <div class="input-group">
            <label>Date (DD/MM/YYYY)</label>
            <input type="text" id="dateInput" placeholder="e.g., 25/12/2023">
        </div>
        <div class="input-group">
            <label>Time (AM/PM only)</label>
            <input type="text" id="timeInput" placeholder="e.g., 10:30 AM">
        </div>
        <div class="error-message" id="errorMessage"></div>
        <button id="saveBtn">Save</button>
    </div>
    
    <div id="listView">
        <div class="empty-message">No times added yet. Click "Add Time" to get started.</div>
    </div>
    
    <button id="deleteBtn" style="display: none;">Delete Selected</button>

    <script>
        // Get DOM elements
        const addTimeBtn = document.getElementById('addTimeBtn');
        const inputBox = document.getElementById('inputBox');
        const dateInput = document.getElementById('dateInput');
        const timeInput = document.getElementById('timeInput');
        const saveBtn = document.getElementById('saveBtn');
        const listView = document.getElementById('listView');
        const deleteBtn = document.getElementById('deleteBtn');
        const errorMessage = document.getElementById('errorMessage');
        
        // Initialize with current date
        const now = new Date();
        const currentDate = `${String(now.getDate()).padStart(2, '0')}/${String(now.getMonth() + 1).padStart(2, '0')}/${now.getFullYear()}`;
        dateInput.value = currentDate;
        
        // Load saved times from localStorage
        let times = JSON.parse(localStorage.getItem('time')) || [];
        
        // Check if time entry already exists
        function isTimeExists(date, time) {
            return times.some(item => 
                item.date === date && item.time.toUpperCase() === time.toUpperCase()
            );
        }
        
        // Validate date format (DD/MM/YYYY)
        function isValidDate(dateStr) {
            const regex = /^\d{2}\/\d{2}\/\d{4}$/;
            if (!regex.test(dateStr)) return false;
            
            const parts = dateStr.split('/');
            const day = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10);
            const year = parseInt(parts[2], 10);
            
            if (year < 1000 || year > 3000 || month === 0 || month > 12) return false;
            
            const monthDays = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            
            // Adjust for leap years
            if (year % 400 === 0 || (year % 100 !== 0 && year % 4 === 0)) {
                monthDays[1] = 29;
            }
            
            return day > 0 && day <= monthDays[month - 1];
        }
        
        // Convert date string to sortable format (YYYYMMDD)
        function getSortableDate(dateStr) {
            const parts = dateStr.split('/');
            return parts[2] + parts[1].padStart(2, '0') + parts[0].padStart(2, '0');
        }
        
        // Navigate to main.html with selected time data
        function navigateToMain(selectedDate, selectedTime) {
            // Encode the date and time for URL
            const encodedDate = encodeURIComponent(selectedDate);
            const encodedTime = encodeURIComponent(selectedTime);
            // Navigate to main.html with parameters
            window.location.href = `main.html?date=${encodedDate}&time=${encodedTime}`;
        }
        
        // Sort times by date (oldest at bottom, newest at top)
        function sortTimes() {
            return times.sort((a, b) => {
                const dateA = getSortableDate(a.date);
                const dateB = getSortableDate(b.date);
                return dateB.localeCompare(dateA); // Reverse order for newest first
            });
        }
        
        // Update list display
        function updateListView() {
            // Clear current list
            listView.innerHTML = '';
            
            if (times.length === 0) {
                listView.innerHTML = '<div class="empty-message">No times added yet. Click "Add Time" to get started.</div>';
                deleteBtn.style.display = 'none';
                return;
            }
            
            // Sort times by date (newest first)
            const sortedTimes = sortTimes();
            
            sortedTimes.forEach((timeObj, index) => {
                const item = document.createElement('a');
                item.className = 'list-item';
                item.href = '#';
                
                item.innerHTML = `
                    <div class="item-content">
                        <div class="item-date">${timeObj.date}</div>
                        <div class="item-time">${timeObj.time}</div>
                        <button class="item-delete">‚ùé</button>
                    </div>
                `;
                
                // Navigate to main.html when list item is clicked
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // Only navigate if delete button was NOT clicked
                    if (!e.target.classList.contains('item-delete')) {
                        navigateToMain(timeObj.date, timeObj.time);
                    }
                });
                
                // Delete individual item with confirmation
                const deleteBtnEl = item.querySelector('.item-delete');
                deleteBtnEl.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Show confirmation dialog
                    if (confirm('Are you sure you want to delete this time entry?')) {
                        // Find and remove the item from times array
                        const itemIndex = times.findIndex(t => 
                            t.date === timeObj.date && t.time === timeObj.time
                        );
                        if (itemIndex !== -1) {
                            times.splice(itemIndex, 1);
                            localStorage.setItem('time', JSON.stringify(times));
                            updateListView();
                        }
                    }
                });
                
                listView.appendChild(item);
            });
        }
        
        // Show input box when Add Time button is clicked
        addTimeBtn.addEventListener('click', () => {
            inputBox.style.display = 'block';
            dateInput.value = currentDate;
            timeInput.value = '';
            timeInput.focus();
            errorMessage.style.display = 'none';
        });
        
        // Format date input (add slashes automatically)
        dateInput.addEventListener('input', (e) => {
            let value = e.target.value.replace(/\D/g, '');
            
            if (value.length >= 2) {
                value = value.slice(0, 2) + '/' + value.slice(2);
            }
            if (value.length >= 5) {
                value = value.slice(0, 5) + '/' + value.slice(5);
            }
            if (value.length > 10) {
                value = value.slice(0, 10);
            }
            
            e.target.value = value;
        });
        
        // Restrict time input to AM/PM format
        timeInput.addEventListener('input', (e) => {
            let value = e.target.value.toUpperCase();
            
            // Remove any characters that aren't numbers, spaces, colon, A, M, or P
            value = value.replace(/[^0-9:APM\s]/g, '');
            
            // Ensure only AM or PM is allowed at the end
            if (value.length >= 2) {
                const lastTwo = value.slice(-2);
                if (lastTwo === 'AM' || lastTwo === 'PM') {
                    // Keep as is
                } else if (value.slice(-1) === 'A' || value.slice(-1) === 'P') {
                    // Allow A or P alone
                } else if (!value.slice(-1).match(/[APM0-9:\s]/)) {
                    value = value.slice(0, -1);
                }
            }
            
            e.target.value = value;
        });
        
        // Save time entry
        saveBtn.addEventListener('click', () => {
            const dateValue = dateInput.value.trim();
            const timeValue = timeInput.value.trim();
            
            // Hide previous error
            errorMessage.style.display = 'none';
            
            // Validate date format
            if (!isValidDate(dateValue)) {
                errorMessage.textContent = 'Please enter a valid date in DD/MM/YYYY format';
                errorMessage.style.display = 'block';
                return;
            }
            
            // Validate time format (must contain AM or PM)
            if (!timeValue.match(/(AM|PM)$/i)) {
                errorMessage.textContent = 'Please enter time in AM/PM format (e.g., "10:30 AM" or "2:00 PM")';
                errorMessage.style.display = 'block';
                return;
            }
            
            // Check if time already exists
            if (isTimeExists(dateValue, timeValue)) {
                errorMessage.textContent = 'This time entry already exists in the list!';
                errorMessage.style.display = 'block';
                return;
            }
            
            // Add to times array
            times.push({
                date: dateValue,
                time: timeValue
            });
            
            // Save to localStorage
            localStorage.setItem('time', JSON.stringify(times));
            
            // Show confirmation alert
            alert('Time entry has been successfully created and saved!');
            
            // Reset and update UI
            inputBox.style.display = 'none';
            updateListView();
        });
        
        // Initialize the list view on load
        updateListView();
        
        // Allow Enter key to save
        timeInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                saveBtn.click();
            }
        });
        
        // Allow Enter key to save from date input too
        dateInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                saveBtn.click();
            }
        });
    </script>
</body>
</html>
